<canvas id="bubbleCanvas"></canvas>

<script>
(function () {
    const categoryData = Object.entries(categories).map(([key, val]) => ({
        name: key,
        value: val.length,
    }));

    const colorPalettes = {
        light: [
            '#d32f2f', '#388e3c', '#1976d2', '#fbc02d', '#7b1fa2',
            '#0097a7', '#f57c00', '#c2185b', '#5d4037', '#303f9f'
        ],
        dark: [
            'hsla(0, 100%, 75%, 0.5)', 'hsla(140, 100%, 75%, 0.5)', 'hsla(210, 100%, 75%, 0.5)',
            'hsla(50, 100%, 75%, 0.5)', 'hsla(280, 100%, 75%, 0.5)',
            'hsla(180, 100%, 75%, 0.5)', 'hsla(20, 100%, 75%, 0.5)', 'hsla(330, 100%, 75%, 0.5)',
            'hsla(30, 100%, 75%, 0.5)', 'hsla(240, 100%, 75%, 0.5)'
        ]
    };

    function getCurrentTheme() {
        const stored = localStorage.getItem("theme");
        if (stored === "light" || stored === "dark") return stored;
        return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }

    const canvas = document.getElementById("bubbleCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    function generateBubbles(theme) {
        const palette = colorPalettes[theme];
        return categoryData.map((cat, i) => {
            const radius = 30 + cat.value * 5;
            return {
                name: cat.name,
                value: cat.value,
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 1.5,
                vy: (Math.random() - 0.5) * 1.5,
                radius,
                baseRadius: radius,
                color: palette[i % palette.length],
                highlight: theme === 'light' ? 'rgba(255, 255, 255, 0.3)' : 'rgba(255, 255, 255, 0.5)',
                fontColor: theme === 'light' ? '#111' : '#fff',
            };
        });
    }

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let currentTheme = getCurrentTheme();
    let bubbles = generateBubbles(currentTheme);

    function drawBubble(bubble) {
        const gradient = ctx.createRadialGradient(
            bubble.x - bubble.radius * 0.3, bubble.y - bubble.radius * 0.3, bubble.radius * 0.1,
            bubble.x, bubble.y, bubble.radius
        );
        gradient.addColorStop(0, bubble.highlight);
        gradient.addColorStop(1, bubble.color);

        ctx.beginPath();
        ctx.arc(bubble.x, bubble.y, bubble.radius, 0, 2 * Math.PI);
        ctx.fillStyle = gradient;
        ctx.shadowColor = "rgba(0,0,0,0.15)";
        ctx.shadowBlur = 6;
        ctx.fill();
        ctx.shadowBlur = 0;

        ctx.fillStyle = bubble.fontColor;
        ctx.font = "bold 11px JetBrains Mono";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(bubble.name, bubble.x, bubble.y);
    }

    function update() {
        // Check if theme has changed
        const newTheme = getCurrentTheme();
        if (newTheme !== currentTheme) {
            currentTheme = newTheme;
            bubbles = generateBubbles(currentTheme);
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let b of bubbles) {
            b.x += b.vx;
            b.y += b.vy;

            if (b.x < b.radius || b.x > canvas.width - b.radius) b.vx *= -1;
            if (b.y < b.radius || b.y > canvas.height - b.radius) b.vy *= -1;

            const pulse = Math.sin(Date.now() * 0.002 + b.value) * 1.5;
            b.radius = b.baseRadius + pulse;

            drawBubble(b);
        }
        requestAnimationFrame(update);
    }

    update();
}());
</script>